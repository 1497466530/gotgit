
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>8.2.2. 钩子和模板 &mdash; GotGit</title>
    
    <link rel="stylesheet" href="../static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/stylesheets/master.css" type="text/css" />
    <link rel="stylesheet" href="/stylesheets/syntax.css" type="text/css" />
    <link rel="stylesheet" href="../static/worldhello.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../static/translations.js"></script>
    <link rel="top" title="GotGit" href="../index.html" />
    <link rel="up" title="8.2. Git 的其他特性" href="050-git-features.html" />
    <link rel="next" title="8.2.3. 稀疏检出和浅克隆" href="090-sparse-checkout-and-shallow-clone.html" />
    <link rel="prev" title="8.2.1. 属性" href="060-attributes.html" /> 
  </head>
  <body>
    <div id='header'>
      <h1><a href='/'>World Hello</a></h1>

      <div id='menu'>
        <ul>
          <li><a href='/' id='home-link' title='Home'>首页</a></li>
          <li><a href='/blog.html' id='blog-link' title='Blog'>博客</a></li>
          <li><a href='/doc/' id='docs-link' title='Docs'>文章</a></li>
          <li><a href='/about.html' id='about-link' title='About'>关于</a></li>
          <li><a href='http://github.com/gotgit' target='_blank' title='GitHub' rel='me' id='github-link'>GitHub</a></li>
          <li><a href='http://weibo.com/gotgit' title='微博' target='_blank' id='weibo-link'>微博</a></li>
        </ul>
      </div>
    </div>

    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="090-sparse-checkout-and-shallow-clone.html" title="8.2.3. 稀疏检出和浅克隆"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="060-attributes.html" title="8.2.1. 属性"
             accesskey="P">上一页</a> |</li>
        <li><a href="../index.html">GotGit</a> &raquo;</li>
          <li><a href="index.html" >8. Git杂谈</a> &raquo;</li>
          <li><a href="050-git-features.html" accesskey="U">8.2. Git 的其他特性</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">8.2.2. 钩子和模板</a><ul>
<li><a class="reference internal" href="#git">8.2.2.1. Git钩子</a><ul>
<li><a class="reference internal" href="#applypatch-msg">8.2.2.1.1. applypatch-msg</a></li>
<li><a class="reference internal" href="#pre-applypatch">8.2.2.1.2. pre-applypatch</a></li>
<li><a class="reference internal" href="#post-applypatch">8.2.2.1.3. post-applypatch</a></li>
<li><a class="reference internal" href="#pre-commit">8.2.2.1.4. pre-commit</a></li>
<li><a class="reference internal" href="#prepare-commit-msg">8.2.2.1.5. prepare-commit-msg</a></li>
<li><a class="reference internal" href="#commit-msg">8.2.2.1.6. commit-msg</a></li>
<li><a class="reference internal" href="#post-commit">8.2.2.1.7. post-commit</a></li>
<li><a class="reference internal" href="#pre-rebase">8.2.2.1.8. pre-rebase</a></li>
<li><a class="reference internal" href="#post-checkout">8.2.2.1.9. post-checkout</a></li>
<li><a class="reference internal" href="#post-merge">8.2.2.1.10. post-merge</a></li>
<li><a class="reference internal" href="#pre-receive">8.2.2.1.11. pre-receive</a></li>
<li><a class="reference internal" href="#update">8.2.2.1.12. update</a></li>
<li><a class="reference internal" href="#post-receive">8.2.2.1.13. post-receive</a></li>
<li><a class="reference internal" href="#post-update">8.2.2.1.14. post-update</a></li>
<li><a class="reference internal" href="#pre-auto-gc">8.2.2.1.15. pre-auto-gc</a></li>
<li><a class="reference internal" href="#post-rewrite">8.2.2.1.16. post-rewrite</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id2">8.2.2.2. Git模板</a></li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="060-attributes.html"
                        title="上一章">8.2.1. 属性</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="090-sparse-checkout-and-shallow-clone.html"
                        title="下一章">8.2.3. 稀疏检出和浅克隆</a></p>
  <h3>本页</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/08-git-misc/070-hooks-and-templates.txt"
           rel="nofollow">显示源代码</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>快速搜索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="转向" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    输入相关的术语，模块，类或者函数名称进行搜索
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="id1">
<h1>8.2.2. 钩子和模板<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<div class="section" id="git">
<h2>8.2.2.1. Git钩子<a class="headerlink" href="#git" title="永久链接至标题">¶</a></h2>
<p>Git的钩子脚本位于版本库<tt class="file docutils literal"><span class="pre">.git/hooks</span></tt>目录下，当Git执行特定操作时会调用特定的钩子脚本。当版本库通过<strong class="command">git init</strong>或者<strong class="command">git clone</strong>创建时，会在<tt class="file docutils literal"><span class="pre">.git/hooks</span></tt>目录下创建示例脚本，用户可以参照示例脚本的写法开发适合的钩子脚本。</p>
<p>钩子脚本要设置为可运行，并使用特定的名称。Git提供的示例脚本都带有<tt class="docutils literal"><span class="pre">.sample</span></tt>扩展名，是为了防止被意外运行。如果需要启用相应的钩子脚本，需要对其重命名（去掉<tt class="docutils literal"><span class="pre">.sample</span></tt>扩展名）。下面分别对可用的钩子脚本逐一介绍。</p>
<div class="section" id="applypatch-msg">
<h3>8.2.2.1.1. applypatch-msg<a class="headerlink" href="#applypatch-msg" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由<strong class="command">git am</strong>命令调用。在调用时向该脚本传递一个参数，即保存有提交说明的文件的文件名。如果该脚本运行失败（返回非零值），则<strong class="command">git am</strong>命令在应用该补丁之前终止。</p>
<p>这个钩子脚本可以修改文件中保存的提交说明，以便对提交说明进行规范化以符合项目的标准（如果有的话）。如果提交说明不符合项目标准，脚本直接以非零值退出，拒绝提交。</p>
<p>Git提供的示例脚本<tt class="file docutils literal"><span class="pre">applypatch-msg.sample</span></tt>只是简单的调用<tt class="file docutils literal"><span class="pre">commit-msg</span></tt>钩子脚本（如果存在的话）。这样通过<strong class="command">git am</strong>命令应用补丁和执行<strong class="command">git commit</strong>一样都会执行<tt class="file docutils literal"><span class="pre">commit-msg</span></tt>脚本，因此如须定制，请更改<tt class="file docutils literal"><span class="pre">commit-msg</span></tt>脚本。</p>
</div>
<div class="section" id="pre-applypatch">
<h3>8.2.2.1.2. pre-applypatch<a class="headerlink" href="#pre-applypatch" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由<strong class="command">git am</strong>命令调用。该脚本没有参数，在补丁应用后但尚未提交之前运行。如果该脚本运行失败（返回非零值），则已经应用补丁的工作区文件不会被提交。</p>
<p>这个脚本可以用于对应用补丁后的工作区进行测试，如果测试没有通过则拒绝提交。</p>
<p>Git提供的示例脚本<tt class="file docutils literal"><span class="pre">pre-applypatch.sample</span></tt>只是简单的调用<tt class="file docutils literal"><span class="pre">pre-commit</span></tt>钩子脚本（如果存在的话）。这样通过<strong class="command">git am</strong>命令应用补丁和执行<strong class="command">git commit</strong>一样都会执行<tt class="file docutils literal"><span class="pre">pre-commit</span></tt>脚本，因此如须定制，请更改<tt class="file docutils literal"><span class="pre">pre-commit</span></tt>脚本。</p>
</div>
<div class="section" id="post-applypatch">
<h3>8.2.2.1.3. post-applypatch<a class="headerlink" href="#post-applypatch" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由<strong class="command">git am</strong>命令调用。该脚本没有参数，在补丁应用并且提交之后运行，因此该钩子脚本不会影响<strong class="command">git am</strong>的运行结果，可以用于发送通知。</p>
</div>
<div class="section" id="pre-commit">
<h3>8.2.2.1.4. pre-commit<a class="headerlink" href="#pre-commit" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由<strong class="command">git commit</strong>命令调用。可以向该脚本传递<tt class="docutils literal"><span class="pre">--no-verify</span></tt>参数，此外别无参数。该脚本在获取提交说明之前运行。如果该脚本运行失败（返回非零值），Git提交被终止。</p>
<p>该脚本主要用于对提交数据的检查，例如对文件名进行检查（是否使用了中文文件名），或者对文件内容进行检查（是否使用了不规范的空白字符）。</p>
<p>Git提供的示例脚本<tt class="file docutils literal"><span class="pre">pre-commit.sample</span></tt>禁止提交在路径中使用了非ASCII字符（如中文字符）的文件。如果确有使用的必要，可以在Git配置文件中设置配置变量<tt class="docutils literal"><span class="pre">hooks.allownonascii</span></tt>为<tt class="docutils literal"><span class="pre">true</span></tt>以允许在文件名中使用非ASCII字符。Git提供的该示例脚本也对不规范的空白字符进行检查，如果发现则终止提交。</p>
<p>Topgit为所管理的版本库设置了自己的<tt class="file docutils literal"><span class="pre">pre-commit</span></tt>脚本，检查工作的Topgit特性分支是否正确设置了两个Topgit管理文件<tt class="file docutils literal"><span class="pre">.topdeps</span></tt>和<tt class="file docutils literal"><span class="pre">.topmsg</span></tt>，以及定义的分支依赖是否存在着重复依赖和循环依赖等。</p>
</div>
<div class="section" id="prepare-commit-msg">
<h3>8.2.2.1.5. prepare-commit-msg<a class="headerlink" href="#prepare-commit-msg" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由<strong class="command">git commit</strong>命令调用，在默认的提交信息准备完成后但编辑器尚未启动之前运行。</p>
<p>该脚本有1到3个参数。第一个参数是包含提交说明的文件的文件名。第二个参数是提交说明的来源，可以是<tt class="docutils literal"><span class="pre">message</span></tt>（由<tt class="docutils literal"><span class="pre">-m</span></tt>或者<tt class="docutils literal"><span class="pre">-F</span></tt>参数提供），可以是<tt class="docutils literal"><span class="pre">template</span></tt>（如果使用了<tt class="docutils literal"><span class="pre">-t</span></tt>参数或由<tt class="docutils literal"><span class="pre">commit.template</span></tt>配置变量提供），或者是<tt class="docutils literal"><span class="pre">merge</span></tt>（如果提交是一个合并或存在<tt class="file docutils literal"><span class="pre">.git/MERGE_MSG</span></tt>文件），或者是<tt class="docutils literal"><span class="pre">squash</span></tt>（如果存在<tt class="file docutils literal"><span class="pre">.git/SQUASH_MSG</span></tt>文件），或者是<tt class="docutils literal"><span class="pre">commit</span></tt>并跟着一个提交SHA1哈希值（如果使用<tt class="docutils literal"><span class="pre">-c</span></tt>、<tt class="docutils literal"><span class="pre">-C</span></tt>或者<tt class="docutils literal"><span class="pre">--amend</span></tt>参数）。</p>
<p>如果该脚本运行失败（返回非零值），Git提交被终止。</p>
<p>该脚本用于对提交说明进行编辑，并且该脚本不会因为<tt class="docutils literal"><span class="pre">--no-verify</span></tt>参数被禁用。</p>
<p>Git提供的示例脚本<tt class="file docutils literal"><span class="pre">prepare-commit-msg.sample</span></tt>可以用于向提交说明中嵌入提交者签名，或者将来自<tt class="docutils literal"><span class="pre">merge</span></tt>的提交说明中的含有“Conflicts:”的行去掉。</p>
</div>
<div class="section" id="commit-msg">
<h3>8.2.2.1.6. commit-msg<a class="headerlink" href="#commit-msg" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由<strong class="command">git commit</strong>命令调用，可以通过传递<tt class="docutils literal"><span class="pre">--no-verify</span></tt>参数而禁用。该脚本有一个参数，即包含有提交说明的文件的文件名。如果该脚本运行失败（返回非零值），Git提交被终止。</p>
<p>该脚本可以直接修改提交说明，可以用于对提交说明规范化以符合项目的标准（如果有的话）。如果提交说明不符合标准，可以拒绝提交。</p>
<p>Git提供的示例脚本<tt class="file docutils literal"><span class="pre">commit-msg.sample</span></tt>检查提交说明中出现的相同的<tt class="docutils literal"><span class="pre">Signed-off-by</span></tt>行，如果发现重复签名即报错、终止提交。</p>
<p>Gerrit服务器需要每一个向其进行推送的Git版本库在本地使用Gerrit提供的<tt class="file docutils literal"><span class="pre">commit-msg</span></tt>钩子脚本，以便在创建的提交中包含形如“Change-Id: I...”的变更集标签。</p>
</div>
<div class="section" id="post-commit">
<h3>8.2.2.1.7. post-commit<a class="headerlink" href="#post-commit" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由<strong class="command">git commit</strong>命令调用，不带参数运行，在提交完成之后被触发执行。</p>
<p>该钩子脚本不会影响<strong class="command">git commit</strong>的运行结果，可以用于发送通知。</p>
</div>
<div class="section" id="pre-rebase">
<h3>8.2.2.1.8. pre-rebase<a class="headerlink" href="#pre-rebase" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由<strong class="command">git rebase</strong>命令调用，用于防止某个分支参与变基。</p>
<p>Git提供的示例脚本<tt class="file docutils literal"><span class="pre">pre-rebase.sample</span></tt>是针对Git项目自身情况而开发的，当一个功能分支已经合并到<tt class="docutils literal"><span class="pre">next</span></tt>分支后，禁止该分基进行变基操作。</p>
</div>
<div class="section" id="post-checkout">
<h3>8.2.2.1.9. post-checkout<a class="headerlink" href="#post-checkout" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由<strong class="command">git checkout</strong>命令调用，是在完成工作区更新之后触发执行。该钩子脚本有三个参数：前一个HEAD的引用，新HEAD的引用（可能和前一个一样也可能不一样），以及一个用于表示此次检出是否是分支检出的标识（分支检出为1，文件检出是0）。该钩子脚本不会影响<strong class="command">git checkout</strong>命令的结果。</p>
<p>除了由<strong class="command">git checkout</strong>命令调用外，该钩子脚本也在<strong class="command">git clone</strong>命令执行后被触发执行，除非在克隆时使用了禁止检出的<tt class="docutils literal"><span class="pre">--no-checkout</span> <span class="pre">(-n)</span></tt>参数。在由<strong class="command">git clone</strong>调用时，第一个参数给出的引用是空引用，则第二个和第三个参数都为1。</p>
<p>这个钩子一般用于版本库的有效性检查，自动显示和前一个HEAD的差异，或者设置工作区属性。</p>
</div>
<div class="section" id="post-merge">
<h3>8.2.2.1.10. post-merge<a class="headerlink" href="#post-merge" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由<strong class="command">git merge</strong>命令调用，当在本地版本库完成<strong class="command">git pull</strong>操作后触发执行。该钩子脚本有一个参数，标识合并是否是一个压缩合并。该钩子脚本不会影响<strong class="command">git merge</strong>命令的结果。如果合并因为冲突而失败，该脚本不会执行。</p>
<p>该钩子脚本可以与<tt class="file docutils literal"><span class="pre">pre-commit</span></tt>钩子脚本一起实现对工作区目录树属性（如权限/属主/ACL等）的保存和恢复。参见Git源码文件<tt class="file docutils literal"><span class="pre">contrib/hooks/setgitperms.perl</span></tt>中的示例。</p>
</div>
<div class="section" id="pre-receive">
<h3>8.2.2.1.11. pre-receive<a class="headerlink" href="#pre-receive" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由远程版本库的<strong class="command">git receive-pack</strong>命令调用。当从本地版本库完成一个推送之后，在远程服务器上开始批量更新引用之前，该钩子脚本被触发执行。该钩子脚本的退出状态决定了更新引用的成功与否。</p>
<p>该钩子脚本在接收（receive）操作中只执行一次。传递参数不通过命令行，而是通过标准输入进行传递。通过标准输入传递的每一行的语法格式为：</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;old-value&gt; &lt;new-value&gt; &lt;ref-name&gt;
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">&lt;old-value&gt;</span></tt>是引用更新前的老的对象ID，<tt class="docutils literal"><span class="pre">&lt;new-value&gt;</span></tt>是引用即将更新到的新的对象ID，<tt class="docutils literal"><span class="pre">&lt;ref-name&gt;</span></tt>是引用的全名。当创建一个新引用时，<tt class="docutils literal"><span class="pre">&lt;old-value&gt;</span></tt>是40个0。</p>
<p>如果该钩子脚本以非零值退出，一个引用也不会更新。如果该脚本正常退出，每一个单独的引用的更新仍有可能被<tt class="docutils literal"><span class="pre">update</span></tt>钩子所阻止。</p>
<p>标准输出和标准错误都重定向到在另外一端执行的<strong class="command">git send-pack</strong>，所以可以直接通过<strong class="command">echo</strong>命令向用户传递信息。</p>
</div>
<div class="section" id="update">
<h3>8.2.2.1.12. update<a class="headerlink" href="#update" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由远程版本库的<strong class="command">git receive-pack</strong>命令调用。当从本地版本库完成一个推送之后，在远程服务器上更新引用时，该钩子脚本被触发执行。该钩子脚本的退出状态决定了更新引用的成功与否。</p>
<p>该钩子脚本在每一个引用更新的时候都会执行一次。该脚本有三个参数。</p>
<ul class="simple">
<li>参数1：要更新的引用的名称。</li>
<li>参数2：引用中保存的旧对象名称。</li>
<li>参数3：将要保存到引用中的新对象名称。</li>
</ul>
<p>正常退出（返回0）允许引用的更新，而以非零值退出禁止<strong class="command">git-receive-pack</strong>更新该引用。</p>
<p>该钩子脚本可以用于防止对某些引用的强制更新，因为该脚本可以通过检查新旧引用对象是否存在继承关系，从而提供更为细致的“非快进式推送”的授权。</p>
<p>该钩子脚本也可以用于记录（如用邮件）引用变更历史<tt class="docutils literal"><span class="pre">old..new</span></tt>。然而因为该脚本不知道整个的分支，所以可能会导致每一个引用发送一封邮件。因此如果要发送通知邮件，可能<tt class="docutils literal"><span class="pre">post-receive</span></tt>钩子脚本更适合。</p>
<p>另外，该脚本可以实现基于路径的授权。</p>
<p>标准输出和标准错误都重定向到在另外一端执行的<strong class="command">git send-pack</strong>，所以可以直接通过<strong class="command">echo</strong>命令向用户传递信息。</p>
<p>Git提供的示例脚本<tt class="file docutils literal"><span class="pre">update.sample</span></tt>展示了对多种危险的Git操作行为进行控制的可行性。</p>
<ul class="simple">
<li>只有将配置变量<tt class="docutils literal"><span class="pre">hooks.allowunannotated</span></tt>设置为<tt class="docutils literal"><span class="pre">true</span></tt>才允许推送轻量级里程碑（不带说明的里程碑）。</li>
<li>只有将配置变量<tt class="docutils literal"><span class="pre">hooks.allowdeletebranch</span></tt>设置为<tt class="docutils literal"><span class="pre">true</span></tt>才允许删除分支。</li>
<li>如果将配置变量<tt class="docutils literal"><span class="pre">hooks.denycreatebranch</span></tt>设置为<tt class="docutils literal"><span class="pre">true</span></tt>则不允许创建新分支。</li>
<li>只有将配置变量<tt class="docutils literal"><span class="pre">hooks.allowdeletetag</span></tt>设置为<tt class="docutils literal"><span class="pre">true</span></tt>才允许删除里程碑。</li>
<li>只有将配置变量<tt class="docutils literal"><span class="pre">hooks.allowmodifytag</span></tt>设置为<tt class="docutils literal"><span class="pre">true</span></tt>才允许修改里程碑。</li>
</ul>
<p>相比Git的示例脚本，Gitolite服务器为其管理的版本库设置的<tt class="docutils literal"><span class="pre">update</span></tt>钩子脚本更实用也更强大。Gitolite实现了用户认证，并通过检查授权文件，实现基于分支和路径的写操作授权，等等。具体参见本书第5篇“第30章Gitolite服务架设”相关内容。</p>
</div>
<div class="section" id="post-receive">
<h3>8.2.2.1.13. post-receive<a class="headerlink" href="#post-receive" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由远程版本库的<strong class="command">git receive-pack</strong>命令调用。当从本地版本库完成一个推送，并且在远程服务器上所有引用都更新完毕后，该钩子脚本被触发执行。</p>
<p>该钩子脚本在接收（receive）操作中只执行一次。该脚本不通过命令行传递参数，但是像<tt class="docutils literal"><span class="pre">pre-receive</span></tt>钩子脚本那样，通过标准输入以相同格式获取信息。</p>
<p>该钩子脚本不会影响<tt class="docutils literal"><span class="pre">git-receive-pack</span></tt>的结果，因为调用该脚本时工作已经完成。</p>
<p>该钩子脚本胜过<tt class="docutils literal"><span class="pre">post-update</span></tt>脚本之处在于可以获得所有引用的老的和新的值，以及引用的名称。</p>
<p>标准输出和标准错误都重定向到在另外一端执行的<strong class="command">git send-pack</strong>，所以可以直接通过<strong class="command">echo</strong>命令向用户传递信息。</p>
<p>Git提供的示例脚本<tt class="file docutils literal"><span class="pre">post-receive.sample</span></tt>引入了<tt class="file docutils literal"><span class="pre">contrib/hooks</span></tt>目录下的名为<tt class="file docutils literal"><span class="pre">post-receive-email</span></tt>的示例脚本（默认被注释），以实现发送通知邮件的功能。</p>
<p>Gitolite服务器要对其管理的Git版本库设置<tt class="file docutils literal"><span class="pre">post-receive</span></tt>钩子脚本，以实现当版本库有变更后进行到各个镜像版本库的数据传输。</p>
</div>
<div class="section" id="post-update">
<h3>8.2.2.1.14. post-update<a class="headerlink" href="#post-update" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由远程版本库的<strong class="command">git receive-pack</strong>命令调用。当从本地版本库完成一个推送之后，即当所有引用都更新完毕后，在远程服务器上该钩子脚本被触发执行。</p>
<p>该脚本接收不定长的参数，每一个参数实际上就是已成功更新的引用名。</p>
<p>该钩子脚本不会影响<strong class="command">git-receive-pack</strong>的结果，因此主要用于通知。</p>
<p>钩子脚本<tt class="docutils literal"><span class="pre">post-update</span></tt>虽然能够提供那些引用被更新了，但是该脚本不知道引用更新前后的对象SHA1哈希值，所以在这个脚本中不能记录形如<tt class="docutils literal"><span class="pre">old..new</span></tt>的引用变更范围。而钩子脚本<tt class="docutils literal"><span class="pre">post-receive</span></tt>知道更新引用前后的对象ID，因此更适合此种场合。</p>
<p>标准输出和标准错误都重定向到在另外一端执行的<strong class="command">git send-pack</strong>，所以可以直接通过<strong class="command">echo</strong>命令向用户传递信息。</p>
<p>Git提供的示例脚本<tt class="docutils literal"><span class="pre">post-update.sample</span></tt>会运行<strong class="command">git update-server-info</strong>命令，以更新哑协议需要的索引文件。如果通过哑协议共享版本库，应该启用该钩子脚本。</p>
</div>
<div class="section" id="pre-auto-gc">
<h3>8.2.2.1.15. pre-auto-gc<a class="headerlink" href="#pre-auto-gc" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由<strong class="command">git gc &#8211;auto</strong>命令调用，不带参数运行，如果以非零值退出会导致<strong class="command">git gc &#8211;auto</strong>被中断。</p>
</div>
<div class="section" id="post-rewrite">
<h3>8.2.2.1.16. post-rewrite<a class="headerlink" href="#post-rewrite" title="永久链接至标题">¶</a></h3>
<p>该钩子脚本由一些重写提交的命令调用，如<strong class="command">git commit &#8211;amend</strong>、<strong class="command">git rebase</strong>，而<strong class="command">git-filter-branch</strong>当前尚未调用该钩子脚本。</p>
<p>该脚本的第一个参数用于判断调用来自哪个命令，当前有<tt class="docutils literal"><span class="pre">amend</span></tt>和<tt class="docutils literal"><span class="pre">rebase</span></tt>两个取值，也可能将来会有其他更多命令相关参数传递。</p>
<p>该脚本通过标准输入接收一个重写提交列表，每一行输入的格式如下：</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;old-sha1&gt; &lt;new-sha1&gt; [&lt;extra-info&gt;]
</pre></div>
</div>
<p>前两个是旧的和新的对象SHA1哈希值。而<tt class="docutils literal"><span class="pre">&lt;extra-info&gt;</span></tt>参数是和调用命令相关的，而当前该参数为空。</p>
</div>
</div>
<div class="section" id="id2">
<h2>8.2.2.2. Git模板<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>当执行<strong class="command">git init</strong>或<strong class="command">git clone</strong>创建版本库时，会自动在版本库中创建钩子脚本（<tt class="file docutils literal"><span class="pre">.git/hooks/*</span></tt>）、忽略文件（<tt class="file docutils literal"><span class="pre">.git/info/exclude</span></tt>）及其他文件，实际上这些文件均拷贝自模板目录。如果需要本地版本库使用定制的钩子脚本等文件，直接在模板目录内创建（文件或符号链接）会事半功倍。</p>
<p>Git按照以下列顺序第一个确认的路径即为模板目录。</p>
<ul>
<li><p class="first">如果执行<strong class="command">git init</strong>或<strong class="command">git clone</strong>命令时，提供<tt class="docutils literal"><span class="pre">--template=&lt;DIR&gt;</span></tt>参数，则使用指定的目录作为模板目录。</p>
</li>
<li><p class="first">由环境变量<tt class="docutils literal"><span class="pre">$GIT_TEMPLATE_DIR</span></tt>指定的模板目录。</p>
</li>
<li><p class="first">由Git配置变量<tt class="docutils literal"><span class="pre">init.templatedir</span></tt>指定的模板目录。</p>
</li>
<li><p class="first">缺省的模板目录，根据Git安装路径的不同可能位于不同的目录下。可以通过下面命令确认其实际位置：</p>
<div class="highlight-python"><div class="highlight"><pre>$ ( cd $(git --html-path)/../../git-core/templates; pwd )
/usr/share/git-core/templates
</pre></div>
</div>
</li>
</ul>
<p>如果在执行版本库初始化时传递了空的模板路径，则不会在版本库中创建钩子脚本
等文件。</p>
<div class="highlight-python"><div class="highlight"><pre>$ git init --template= no-template
Initialized empty Git repository in /path/to/my/workspace/no-template/.git/
</pre></div>
</div>
<p>执行下面的命令，查看新创建的版本库<tt class="file docutils literal"><span class="pre">.git</span></tt>目录下的文件。</p>
<div class="highlight-python"><div class="highlight"><pre>$ ls -F no-template/.git/
HEAD     config   objects/ refs/
</pre></div>
</div>
<p>可以看到不使用模板目录创建的版本库下面的文件少的可怜。而通过对模板目录下的文件的定制，可以实现在建立的版本库中包含预先设置好的钩子脚本、忽略文件、属性文件等。这对于服务器或者对版本库操作有特殊要求的项目带来方便。</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="090-sparse-checkout-and-shallow-clone.html" title="8.2.3. 稀疏检出和浅克隆"
             >下一页</a> |</li>
        <li class="right" >
          <a href="060-attributes.html" title="8.2.1. 属性"
             >上一页</a> |</li>
        <li><a href="../index.html">GotGit</a> &raquo;</li>
          <li><a href="index.html" >8. Git杂谈</a> &raquo;</li>
          <li><a href="050-git-features.html" >8.2. Git 的其他特性</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a>
      <br />
      全部内容以 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons 署名-非商业性使用-相同方式共享 3.0 协议发布</a>.
      <br />
        &copy; Copyright 2011, 蒋鑫。
      使用 <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3 创建。

    </div>
  </body>
</html>
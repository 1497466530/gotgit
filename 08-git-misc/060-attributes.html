
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>8.2.1. 属性 &mdash; GotGit</title>
    
    <link rel="stylesheet" href="../static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="/stylesheets/master.css" type="text/css" />
    <link rel="stylesheet" href="/stylesheets/syntax.css" type="text/css" />
    <link rel="stylesheet" href="../static/worldhello.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../static/translations.js"></script>
    <link rel="top" title="GotGit" href="../index.html" />
    <link rel="up" title="8.2. Git 的其他特性" href="050-git-features.html" />
    <link rel="next" title="8.2.2. 钩子和模板" href="070-hooks-and-templates.html" />
    <link rel="prev" title="8.2. Git 的其他特性" href="050-git-features.html" /> 
  </head>
  <body>
    <div id='header'>
      <h1><a href='/'>World Hello</a></h1>

      <div id='menu'>
        <ul>
          <li><a href='/' id='home-link' title='Home'>首页</a></li>
          <li><a href='/blog.html' id='blog-link' title='Blog'>博客</a></li>
          <li><a href='/doc/' id='docs-link' title='Docs'>文章</a></li>
          <li><a href='/about.html' id='about-link' title='About'>关于</a></li>
          <li><a href='http://github.com/gotgit' target='_blank' title='GitHub' rel='me' id='github-link'>GitHub</a></li>
          <li><a href='http://weibo.com/gotgit' title='微博' target='_blank' id='weibo-link'>微博</a></li>
        </ul>
      </div>
    </div>

    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="070-hooks-and-templates.html" title="8.2.2. 钩子和模板"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="050-git-features.html" title="8.2. Git 的其他特性"
             accesskey="P">上一页</a> |</li>
        <li><a href="../index.html">GotGit</a> &raquo;</li>
          <li><a href="index.html" >8. Git杂谈</a> &raquo;</li>
          <li><a href="050-git-features.html" accesskey="U">8.2. Git 的其他特性</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">內容目录</a></h3>
  <ul>
<li><a class="reference internal" href="#">8.2.1. 属性</a><ul>
<li><a class="reference internal" href="#id2">8.2.1.1. 属性定义</a></li>
<li><a class="reference internal" href="#id3">8.2.1.2. 属性文件及优先级</a></li>
<li><a class="reference internal" href="#id4">8.2.1.3. 常用属性介绍</a><ul>
<li><a class="reference internal" href="#text">8.2.1.3.1. text</a></li>
<li><a class="reference internal" href="#eol">8.2.1.3.2. eol</a></li>
<li><a class="reference internal" href="#ident">8.2.1.3.3. ident</a></li>
<li><a class="reference internal" href="#filter">8.2.1.3.4. filter</a></li>
<li><a class="reference internal" href="#diff">8.2.1.3.5. diff</a></li>
<li><a class="reference internal" href="#merge">8.2.1.3.6. merge</a></li>
<li><a class="reference internal" href="#whitespace">8.2.1.3.7. whitespace</a></li>
<li><a class="reference internal" href="#export-ignore">8.2.1.3.8. export-ignore</a></li>
<li><a class="reference internal" href="#export-subst">8.2.1.3.9. export-subst</a></li>
<li><a class="reference internal" href="#delta">8.2.1.3.10. delta</a></li>
<li><a class="reference internal" href="#encoding">8.2.1.3.11. encoding</a></li>
<li><a class="reference internal" href="#binary">8.2.1.3.12. binary</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>上一个主题</h4>
  <p class="topless"><a href="050-git-features.html"
                        title="上一章">8.2. Git 的其他特性</a></p>
  <h4>下一个主题</h4>
  <p class="topless"><a href="070-hooks-and-templates.html"
                        title="下一章">8.2.2. 钩子和模板</a></p>
  <h3>本页</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/08-git-misc/060-attributes.txt"
           rel="nofollow">显示源代码</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>快速搜索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="转向" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    输入相关的术语，模块，类或者函数名称进行搜索
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="id1">
<h1>8.2.1. 属性<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h1>
<p>Git通过属性文件为版本库中的文件或目录添加属性。设置了属性的文件或目录，例如之前介绍换行符转换时设置了文本属性（<tt class="docutils literal"><span class="pre">text</span></tt>）的文件，在执行Git相关操作时会做特殊处理。</p>
<div class="section" id="id2">
<h2>8.2.1.1. 属性定义<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>属性文件是一个普通的文本文件，每一行对一个路径（可使用通配符）设置相应的属性。语法格式如下：</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;pattern&gt; &lt;attr1&gt; &lt;attr2&gt; ...
</pre></div>
</div>
<p>其中路径由可以使用通配符的<tt class="docutils literal"><span class="pre">&lt;pattern&gt;</span></tt>定义，属性可以设置一个或多个，不同的属性之间用空格分开。路径中通配符的用法和文件忽略（file:<cite>.gitignore</cite>）的语法格式相同，参见本书第2篇“第10.8节文件忽略”相关内容。下面以<tt class="docutils literal"><span class="pre">text</span></tt>属性为例，介绍属性的不同写法：</p>
<ul>
<li><p class="first">text</p>
<p>直接通过属性名进行设置，相当于设置<tt class="docutils literal"><span class="pre">text</span></tt>属性的值为<tt class="docutils literal"><span class="pre">true</span></tt>。</p>
<p>对于设置了<tt class="docutils literal"><span class="pre">text</span></tt>属性的文件，不再需要Git对文件类型进行猜测，而直接判定为文本文件并进行相应的换行符转换。</p>
</li>
<li><p class="first">-text</p>
<p>在属性名前用减号标识，相当于设置<tt class="docutils literal"><span class="pre">text</span></tt>属性值为<tt class="docutils literal"><span class="pre">false</span></tt>。</p>
<p>对于设置了取反<tt class="docutils literal"><span class="pre">text</span></tt>属性的文件，直接判定为二进制文件，在文件检入和检出时不进行换行符转换。</p>
</li>
<li><p class="first">!text</p>
<p>在属性名前面添加感叹号，相当于该属性没有设置，即不等于<tt class="docutils literal"><span class="pre">true</span></tt>，也不等于<tt class="docutils literal"><span class="pre">false</span></tt>。</p>
<p>对于未定义<tt class="docutils literal"><span class="pre">text</span></tt>属性的文件，根据Git是否配置了<tt class="docutils literal"><span class="pre">core.autocrlf</span></tt>配置变量，决定是否进行换行符转换。因此对于<tt class="docutils literal"><span class="pre">text</span></tt>属性没有定义和进行取反<tt class="docutils literal"><span class="pre">text</span></tt>属性设置，两者存在差异。</p>
</li>
<li><p class="first">text=auto</p>
<p>属性除了上述<tt class="docutils literal"><span class="pre">true</span></tt>、<tt class="docutils literal"><span class="pre">false</span></tt>、未设置三个状态外，还可以对属性用相关的枚举值（预定义的字符串）进行设置。不同的属性值可能有不同的枚举值，对于<tt class="docutils literal"><span class="pre">text</span></tt>属性可以设置为<tt class="docutils literal"><span class="pre">auto</span></tt>。</p>
<p>对于<tt class="docutils literal"><span class="pre">text</span></tt>属性设置为<tt class="docutils literal"><span class="pre">auto</span></tt>的文件，文件类型实际上尚未确定，需要Git读取文件内容进行智能判别，判别为文本文件则进行换行符转换。显然当设置<tt class="docutils literal"><span class="pre">text</span></tt>属性为<tt class="docutils literal"><span class="pre">auto</span></tt>时，并不等同于<tt class="docutils literal"><span class="pre">true</span></tt>。</p>
</li>
</ul>
</div>
<div class="section" id="id3">
<h2>8.2.1.2. 属性文件及优先级<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p>属性文件可以以<tt class="file docutils literal"><span class="pre">.gitattributes</span></tt>文件名保存在工作区目录中，提交到版本库后就可以和其他用户共享项目文件的属性设置。属性文件也可以保存在工作区之外，例如保存在文件<tt class="file docutils literal"><span class="pre">.git/info/attributes</span></tt>中，仅对本版本库生效，若保存在<tt class="file docutils literal"><span class="pre">/etc/gitattributes</span></tt>文件中则全局生效。在查询某个工作区某一文件的属性时，在不同位置的属性文件具有不同的优先级，Git依据下列顺序依次访问属性文件。</p>
<ul class="simple">
<li>文件<tt class="file docutils literal"><span class="pre">.git/info/attributes</span></tt>具有最高的优先级。</li>
<li>接下来检查工作区同一目录下的<tt class="file docutils literal"><span class="pre">.gitattributes</span></tt>，并依次向上递归查找<tt class="file docutils literal"><span class="pre">.gitattributes</span></tt>文件，直到工作区的根目录。</li>
<li>然后查询由Git的配置变量<tt class="docutils literal"><span class="pre">core.attributesfile</span></tt>指定的全局属性文件。</li>
<li>最后是系统属性文件，即文件<tt class="file docutils literal"><span class="pre">$(prefix)/etc/gitattributes</span></tt>。不同的Git安装方式这个文件的位置可能不同，但是该文件始终和Git的系统配置文件（可以通过<strong class="command">git config &#8211;system -e</strong>命令打开进而知道位置）位于同一目录中。</li>
</ul>
<p>注意只有在1.7.4或更新版本的Git才提供后两种（全局和系统级的）属性文件。可以通过下面的例子来理解属性文件的优先级和属性设置方法。</p>
<p>首先来看看某个版本库即系统中所包含的属性文件：</p>
<ul>
<li><p class="first">其一是位于版本库中的文件<tt class="file docutils literal"><span class="pre">.git/info/attributes</span></tt>，内容如下：</p>
<div class="highlight-python"><div class="highlight"><pre>a*      foo !bar -baz
</pre></div>
</div>
</li>
<li><p class="first">其二是位于工作区子目录<tt class="file docutils literal"><span class="pre">t</span></tt>下的属性文件，即<tt class="file docutils literal"><span class="pre">t/.gitattributes</span></tt>，内容如下：</p>
<div class="highlight-python"><div class="highlight"><pre>ab*     merge=filfre
abc     -foo -bar
*.c     frotz
</pre></div>
</div>
</li>
<li><p class="first">再一个是位于工作区根目录下的属性文件<tt class="file docutils literal"><span class="pre">.gitattributes</span></tt>，内容如下：</p>
<div class="highlight-python"><div class="highlight"><pre>abc     foo bar baz
</pre></div>
</div>
</li>
<li><p class="first">系统文件<tt class="file docutils literal"><span class="pre">/etc/gitconfig</span></tt>中包含如下配置，则每个用户主目录下的<tt class="file docutils literal"><span class="pre">.gitattributes</span></tt>文件做为全局属性文件。</p>
<div class="highlight-python"><div class="highlight"><pre>[core]
  attributesfile = ~/.gitattributes
</pre></div>
</div>
</li>
<li><p class="first">位于用户主目录下的属性文件，即文件<tt class="file docutils literal"><span class="pre">~/.gitattributes</span></tt>的内容如下：</p>
<div class="highlight-python"><div class="highlight"><pre>* text=auto
</pre></div>
</div>
</li>
</ul>
<p>当查询工作区文件<tt class="file docutils literal"><span class="pre">t/abc</span></tt>的属性时，根据属性文件的优先级，按照下列顺序进行检索：</p>
<ol class="arabic simple">
<li>先检查属性文件<tt class="file docutils literal"><span class="pre">.git/info/attributes</span></tt>。显然该文件中唯一的一行就和文件<tt class="file docutils literal"><span class="pre">t/abc</span></tt>匹配，因此文件<tt class="file docutils literal"><span class="pre">t/abc</span></tt>的属性如下：</li>
</ol>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>foo   : true
bar   : 未设置
baz   : false
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="2">
<li>再检查和文件<tt class="file docutils literal"><span class="pre">t/abc</span></tt>同目录的属性文件<tt class="file docutils literal"><span class="pre">t/.gitattributes</span></tt>。该属性文件的前两行和路径<tt class="file docutils literal"><span class="pre">t/abc</span></tt>相匹配，但是因为第二行设置<tt class="docutils literal"><span class="pre">foo</span></tt>和<tt class="docutils literal"><span class="pre">bar</span></tt>属性已经由属性文件<tt class="file docutils literal"><span class="pre">.git/info/attributes</span></tt>提供，因此第二行的设置不起作用。经过这一步，文件<tt class="file docutils literal"><span class="pre">t/abc</span></tt>获得的属性为：</li>
</ol>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>foo   : true
bar   : 未设置
baz   : false
merge : filfre
</pre></div>
</div>
</div></blockquote>
<ol class="arabic simple" start="3">
<li>然后沿工作区当前目录向上遍历属性文件，找到工作区根目录下的属性文件<tt class="file docutils literal"><span class="pre">.gitattributes</span></tt>，进行检查。因为该属性文件设置的属性已经由前面的属性文件提供，所以文件<tt class="file docutils literal"><span class="pre">t/abc</span></tt>的属性和上面第2步的结果一样。</li>
<li>因为设置了<tt class="docutils literal"><span class="pre">core.attributesfile</span></tt>为<tt class="file docutils literal"><span class="pre">~/.gitattributes</span></tt>文件，因此接下来查找用户主目录下文件即<tt class="file docutils literal"><span class="pre">.gitattributes</span></tt>。该文件唯一的一行匹配所有文件，因此<tt class="file docutils literal"><span class="pre">t/abc</span></tt>又被附加了新的属性值<tt class="docutils literal"><span class="pre">text=auto</span></tt>。最终文件<tt class="file docutils literal"><span class="pre">t/abc</span></tt>的属性如下。</li>
</ol>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>foo   : true
bar   : 未设置
baz   : false
merge : filfre
text  : auto
</pre></div>
</div>
</div></blockquote>
</div>
<div class="section" id="id4">
<h2>8.2.1.3. 常用属性介绍<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h2>
<div class="section" id="text">
<h3>8.2.1.3.1. text<a class="headerlink" href="#text" title="永久链接至标题">¶</a></h3>
<p>属性<tt class="docutils literal"><span class="pre">text</span></tt>用于显式的指定文件的类型：二进制（<tt class="docutils literal"><span class="pre">-text</span></tt>）、文本文件（<tt class="docutils literal"><span class="pre">text</span></tt>）或是开启文件类型的智能判别（<tt class="docutils literal"><span class="pre">text=auto</span></tt>）。对于文本文件，Git会对其进行换行符转换。本书第40章“40.3换行符问题”中已经详细介绍了属性<tt class="docutils literal"><span class="pre">text</span></tt>的用法，并且在本章“40.1.1 属性定义”的示例中对属性<tt class="docutils literal"><span class="pre">text</span></tt>的取值做了总结，在此不再赘述。</p>
<p>在“40.3换行符问题”一节，我们还知道可以通过在Git配置文件中设置<tt class="docutils literal"><span class="pre">core.autocrlf</span></tt>配置变量，来开启Git对文件类型的智能判别，并对文本文件开启换行符转换。那么Git的配置变量<tt class="docutils literal"><span class="pre">core.autocrlf</span></tt>和属性<tt class="docutils literal"><span class="pre">text</span></tt>有什么异同呢？</p>
<p>当设置了Git了配置变量<tt class="docutils literal"><span class="pre">core.autocrlf</span></tt>为<tt class="docutils literal"><span class="pre">true</span></tt>或者<tt class="docutils literal"><span class="pre">input</span></tt>后，相当于设置了属性<tt class="docutils literal"><span class="pre">text=auto</span></tt>。但是Git配置文件中的配置变量只能在本地进行设置并且只对本地版本库有效，不能通过共享版本库传递到其他用户的本地版本库中，因而<tt class="docutils literal"><span class="pre">core.autocrlf</span></tt>开启换行符转换不能跟其他用户共享，或者说不能将换行符转换策略设置为整个项目（版本库）的强制规范。属性文件则不同，可以被检入到版本库中并通过共享版本库传递给其他用户，因此可以通过在检入的<tt class="file docutils literal"><span class="pre">.gitattributes</span></tt>文件中设置<tt class="docutils literal"><span class="pre">text</span></tt>属性，或者干脆设置<tt class="docutils literal"><span class="pre">text=auto</span></tt>属性，强制同一项目的所有用户在提交文本文件时都要规范换行符。</p>
<p>建议所有存在跨平台开发可能的项目都在项目根目录中检入一个<tt class="file docutils literal"><span class="pre">.gitattributes</span></tt>文件，根据文件扩展名设置文件的<tt class="docutils literal"><span class="pre">text</span></tt>属性，或者设置即将介绍的<tt class="docutils literal"><span class="pre">eol</span></tt>属性。</p>
</div>
<div class="section" id="eol">
<h3>8.2.1.3.2. eol<a class="headerlink" href="#eol" title="永久链接至标题">¶</a></h3>
<p>属性<tt class="docutils literal"><span class="pre">eol</span></tt>用于设定文本文件的换行符格式。对于设置了<tt class="docutils literal"><span class="pre">eol</span></tt>属性的文件，如果没有设定<tt class="docutils literal"><span class="pre">text</span></tt>属性时，默认会设置<tt class="docutils literal"><span class="pre">text</span></tt>属性为<tt class="docutils literal"><span class="pre">true</span></tt>。属性<tt class="docutils literal"><span class="pre">eol</span></tt>的取值如下：</p>
<ul>
<li><p class="first">eol=crlf</p>
<p>当文件检入版本库时，blob对象使用LF作为换行符。当检出到工作区时，使用CRLF作为换行符。</p>
</li>
<li><p class="first">eol=lf</p>
<p>当文件检入版本库时，blob对象使用LF作为换行符，检出的时候工作区文件也使用LF作为换行符。</p>
</li>
</ul>
<p>除了通过属性设定换行符格式外，还可以在Git的配置文件通过<tt class="docutils literal"><span class="pre">core.eol</span></tt>配置变量来设定。两者的区别在于配置文件中的<tt class="docutils literal"><span class="pre">core.eol</span></tt>配置变量设置的换行符是一个默认值，没有通过<tt class="docutils literal"><span class="pre">eol</span></tt>属性指定换行符格式的文本文件会采用<tt class="docutils literal"><span class="pre">core.eol</span></tt>的设置。变量<tt class="docutils literal"><span class="pre">core.eol</span></tt>的值可以设定为<tt class="docutils literal"><span class="pre">lf</span></tt>、<tt class="docutils literal"><span class="pre">crlf</span></tt>和<tt class="docutils literal"><span class="pre">native</span></tt>。默认<tt class="docutils literal"><span class="pre">core.eol</span></tt>的取值为<tt class="docutils literal"><span class="pre">native</span></tt>，即采用操作系统标准的换行符格式。</p>
<p>下面的示例通过属性文件设置文件的换行符格式。</p>
<div class="highlight-python"><div class="highlight"><pre>*.vcproj        eol=crlf
*.sh            eol=lf
</pre></div>
</div>
<p>扩展名为<tt class="docutils literal"><span class="pre">.vcproj</span></tt>的文件使用CRLF作为换行符，而扩展名为<tt class="docutils literal"><span class="pre">.sh</span></tt>的文件使用LF作为换行符。在版本库中检入类似的属性文件，会使得Git客户端无论在什么操作系统中都能够在工作区检出一致的换行符格式，这样无论是在Windows上还是在Linux上使用<strong class="command">git archive</strong>命令将工作区文件打包，导出的文件都会保持正确的换行符格式。</p>
</div>
<div class="section" id="ident">
<h3>8.2.1.3.3. ident<a class="headerlink" href="#ident" title="永久链接至标题">¶</a></h3>
<p>属性<tt class="docutils literal"><span class="pre">ident</span></tt>开启文本文件中的关键字扩展，即关键字<tt class="docutils literal"><span class="pre">$Id$</span></tt>的自动扩展。当检出到工作区时，<tt class="docutils literal"><span class="pre">$Id$</span></tt>自动扩展为<tt class="docutils literal"><span class="pre">$Id:</span></tt>，后面紧接着40位SHA1哈希值（相应blob对象的哈希值），然后以一个<tt class="docutils literal"><span class="pre">$</span></tt>字符结尾。当文件检入时，要对内容中出现的以<tt class="docutils literal"><span class="pre">$Id:</span></tt>开始，以<tt class="docutils literal"><span class="pre">$</span></tt>结束的内容替换为<tt class="docutils literal"><span class="pre">$Id$</span></tt>再保存到blob对象中。</p>
<p>这个功能可以说是对CVS相应功能的模仿。自动扩展的内容使用的是blob的哈希值而非提交本身的哈希值，因此并无太大实际意义，不建议使用。如果希望在文本文件中扩展出提交者姓名、提交ID等更有实际意义的内容，可以参照后面介绍的属性<tt class="docutils literal"><span class="pre">export-subst</span></tt>。</p>
</div>
<div class="section" id="filter">
<h3>8.2.1.3.4. filter<a class="headerlink" href="#filter" title="永久链接至标题">¶</a></h3>
<p>属性<tt class="docutils literal"><span class="pre">filter</span></tt>为文件设置一个自定义转换过滤器，以便文件在检入版本库及检出到工作区时进行相应的转换。定义转换过滤器通过Git配置文件来完成，因此这个属性应该只在本地进行设置，而不要通过检入到版本库中的<tt class="file docutils literal"><span class="pre">.gitattributes</span></tt>文件传递。</p>
<p>例如下面的属性文件设置了所有的C语言源文件在检入和检出的时候使用名为indent的代码格式化过滤器。</p>
<div class="highlight-python"><div class="highlight"><pre>*.c     filter=indent
</pre></div>
</div>
<p>然后还要通过Git配置文件设定indent过滤器，示例如下：</p>
<div class="highlight-python"><div class="highlight"><pre>[filter &quot;indent&quot;]
        clean = indent
        smudge = cat
</pre></div>
</div>
<p>定义过滤器只要设置两条命令，一条是名为clean的配置设定的的命令，用于在文件检入时执行，另外一条是名为smudge的配置设定的命令，用于将文件检出到工作区时使用的命令。对于本例，在代码检入时执行<strong class="command">indent</strong>命令对代码格式化后，再保存到版本库中。当检出到工作区执行<strong class="command">cat</strong>命令，实际上相当于直接将blob对象复制到工作区。</p>
</div>
<div class="section" id="diff">
<h3>8.2.1.3.5. diff<a class="headerlink" href="#diff" title="永久链接至标题">¶</a></h3>
<p>和前面介绍的属性不同，属性<tt class="docutils literal"><span class="pre">diff</span></tt>不会对文件检入检出造成影响，而只是在查看文件历史变更时起作用。属性<tt class="docutils literal"><span class="pre">diff</span></tt>可以取值如下：</p>
<ul>
<li><p class="first">diff</p>
<p>进行版本间比较时，以文本方式进行比较，即使文件看起来像是二进制文件（包含NULL字符），或者被设置为二进制文件（<tt class="docutils literal"><span class="pre">-text</span></tt>）。</p>
</li>
<li><p class="first">-diff</p>
<p>不以文本方式进行差异比较，而以二进制方式进行比较。因为默认查看版本间差异时只显示文本文件的差异不显示二进制文件差异，因此包含<tt class="docutils literal"><span class="pre">-diff</span></tt>属性设置的文件在差异比较时不显示内容上的差异。对于有些文本文件（如postscript文件）进行差异比较没有意义，可以对其设置<tt class="docutils literal"><span class="pre">-diff</span></tt>属性，避免在显示提交间差异时造成干扰。</p>
</li>
<li><p class="first">!diff</p>
<p>不设置<tt class="docutils literal"><span class="pre">diff</span></tt>属性，相当于在执行差异比较时要对文件内容进行智能判别，如果文件看起来像是文本文件，则显示文本格式的差异比较。</p>
</li>
<li><p class="first">diff=&lt;driver&gt;</p>
<p>设定一个外部的驱动用于文件的差异比较。例如对于Word文档的差异比较就可以通过这种方式进行配置。</p>
</li>
</ul>
<p>Word文档属于二进制文件，默认不显示差异比较。在Linux上有一个名为<tt class="docutils literal"><span class="pre">antiword</span></tt>的应用软件可以将Word文档转换为文本文件显示，借助该软件就可以实现在Linux（包括Mac OS X）上显示Word文件的版本间差异。</p>
<p>下面的Git配置就定义了一个名为antiword的适用于Word差异比较的驱动：</p>
<div class="highlight-python"><div class="highlight"><pre>[diff &quot;antiword&quot;]
  textconv=antiword
</pre></div>
</div>
<p>其中<tt class="docutils literal"><span class="pre">textconv</span></tt>属性用于设定一个文件转换命令行，这里设置为<tt class="docutils literal"><span class="pre">antiword</span></tt>，用于将 Word 文档转换为纯文本。</p>
<p>然后还需要设置属性，修改版本库下的<tt class="docutils literal"><span class="pre">.git/info/attributes</span></tt>文件就可以，新增属性设置如下：</p>
<div class="highlight-python"><div class="highlight"><pre>*.doc  diff=antiword
</pre></div>
</div>
<p>关于更多的差异比较外部驱动的设置，执行<tt class="docutils literal"><span class="pre">git</span> <span class="pre">help</span> <span class="pre">--web</span> <span class="pre">attributes</span></tt>参见相关的帮助。</p>
</div>
<div class="section" id="merge">
<h3>8.2.1.3.6. merge<a class="headerlink" href="#merge" title="永久链接至标题">¶</a></h3>
<p>属性<tt class="docutils literal"><span class="pre">merge</span></tt>用于为文件设置指定的合并策略，受影响的Git命令有：<strong class="command">git merge</strong>、<strong class="command">git revert</strong>和<strong class="command">git cherry-pick</strong>等。属性<tt class="docutils literal"><span class="pre">merge</span></tt>可以取值如下：</p>
<ul>
<li><p class="first">merge</p>
<p>使用内置的三向合并策略。</p>
</li>
<li><p class="first">-merge</p>
<p>将当前分支的文件版本设置为暂时的合并结果，并且声明合并发生了冲突，这实际上是二进制文件默认的合并方式。可以对文本文件设置该属性，使得在合并时的行为类似二进制文件。</p>
</li>
<li><p class="first">!merge</p>
<p>和定义了<tt class="docutils literal"><span class="pre">merge</span></tt>属性效果类似，使用内置的三向合并策略。然而当通过Git配置文件的<tt class="docutils literal"><span class="pre">merge.default</span></tt>配置变量设置了合并策略后，如果没有为文件设置<tt class="docutils literal"><span class="pre">merge</span></tt>属性，则使用<tt class="docutils literal"><span class="pre">merge.default</span></tt>设定的策略。</p>
</li>
<li><p class="first">merge=&lt;driver&gt;</p>
<p>使用指定的合并驱动执行三向文件合并。驱动可以是内置的三个驱动，也可以是用户通过Git配置文件自定义的驱动。</p>
</li>
</ul>
<p>下面重点说一说通过枚举值来指定在合并时使用的内置驱动和自定义驱动。先来看看Git提供的三个内置驱动：</p>
<ul>
<li><p class="first">merge=text</p>
<p>默认文本文件在进行三向合并时使用的驱动。会在合并后的文本文件中用特殊的标识<tt class="docutils literal"><span class="pre">&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></tt>、<tt class="docutils literal"><span class="pre">=======</span></tt>和<tt class="docutils literal"><span class="pre">&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></tt>来标记冲突的内容。</p>
</li>
<li><p class="first">merge=binary</p>
<p>默认二进制文件在进行三向合并时使用的驱动。会在工作区中保持当前分支中的版本不变，但是会通过在三个暂存区中进行冲突标识使得文件处于冲突状态。</p>
</li>
<li><p class="first">merge=union</p>
<p>在文本文件三向合并过程中，不使用冲突标志符标识冲突，而是将冲突双方的内容简单的罗列在文件中。用户应该对合并后的文件进行检查。请慎用此合并驱动。</p>
</li>
</ul>
<p>用户还可以自定义驱动。例如Topgit就使用自定义合并驱动的方式来控制两个Topgit管理文件<tt class="file docutils literal"><span class="pre">.topmsg</span></tt>和<tt class="file docutils literal"><span class="pre">.topdeps</span></tt>的合并行为。</p>
<p>Topgit会在版本库的配置文件<tt class="file docutils literal"><span class="pre">.git/info/config</span></tt>中添加下面的设置定义一个名为ours的合并驱动。注意不要将此ours驱动和本书第3篇第16章“16.6合并策略”一节中介绍的ours合并策略弄混淆。</p>
<div class="highlight-python"><div class="highlight"><pre>[merge &quot;ours&quot;]
  name = \&quot;always keep ours\&quot; merge driver
  driver = touch %A
</pre></div>
</div>
<p>定义的合并驱动的名称由<tt class="docutils literal"><span class="pre">merge.*.name</span></tt>给出，合并时执行的命令则由配置<tt class="docutils literal"><span class="pre">merge.*.driver</span></tt>给出。本例中使用了命令<strong class="command">touch %A</strong>，含义为对当前分支中的文件进行简单的触碰（更新文件时间戳），亦即合并冲突时采用本地版本，丢弃其他版本。</p>
<p>Topgit还会在版本库<tt class="file docutils literal"><span class="pre">.git/info/attributes</span></tt>属性文件中包含下面的属性设置：</p>
<div class="highlight-python"><div class="highlight"><pre>.topmsg merge=ours
.topdeps  merge=ours
</pre></div>
</div>
<p>含义为对这两个Topgit管理文件，采用在Git配置文件中设定的ours合并驱动。Topgit之所以要这么实现是因为不同特性分支的管理文件之间并无关联，也不需要合并，在遇到冲突时只使用自己的版本即可。这对于Topgit要经常地执行变基和分支合并来说，设置这个策略可以简化管理，但是这个合并设置在特定情况下也存在不合理之处。例如两个用户工作在同一分支上同时更改了<tt class="file docutils literal"><span class="pre">.topmsg</span></tt>文件以修改特性分支的描述，在合并时会覆盖对方的修改，这显然是不好的行为。但是权衡利弊，还是如此实现最好。</p>
</div>
<div class="section" id="whitespace">
<h3>8.2.1.3.7. whitespace<a class="headerlink" href="#whitespace" title="永久链接至标题">¶</a></h3>
<p>Git可以对文本文件中空白字符的使用是否规范做出检查，在文件差异比较时，将使用不当的空白字符用红色进行标记（开启<tt class="docutils literal"><span class="pre">color.diff.whitespace</span></tt>）。也可以在执行<strong class="command">git apply</strong>时通过参数<tt class="docutils literal"><span class="pre">--whitespace=error</span></tt>防止错误的空白字符应用到提交中。</p>
<p>Git默认开启对下面三类错误空白字符的检查。</p>
<ul>
<li><p class="first">blank-at-eol</p>
<p>在行尾出现的空白字符（换行符之前）被视为误用。</p>
</li>
<li><p class="first">space-before-tab</p>
<p>在行首缩进中出现在TAB字符前面的空白字符视为误用。</p>
</li>
<li><p class="first">blank-at-eof</p>
<p>在文件末尾的空白行视为误用。</p>
</li>
</ul>
<p>Git还支持对更多空白字符的误用做出检测，包括：</p>
<ul>
<li><p class="first">indent-with-non-tab</p>
<p>用8个或者更多的空格进行缩进视为误用。</p>
</li>
<li><p class="first">tab-in-indent</p>
<p>在行首的缩进中使用TAB字符视为误用。显然这个设置和上面的<tt class="docutils literal"><span class="pre">indent-with-non-tab</span></tt>互斥。</p>
</li>
<li><p class="first">trailing-space</p>
<p>相当于同时启用<tt class="docutils literal"><span class="pre">blank-at-eol</span></tt>和<tt class="docutils literal"><span class="pre">blank-at-eof</span></tt>。</p>
</li>
<li><p class="first">cr-at-eol</p>
<p>将行尾的CR（回车）字符视为换行符的一部分。也就是说，在行尾前出现的CR字符不会引起<tt class="docutils literal"><span class="pre">trailing-space</span></tt>报错。</p>
</li>
<li><p class="first">tabwidth=&lt;n&gt;</p>
<p>设置一个TAB字符相当于几个空格，缺省为8个。</p>
</li>
</ul>
<p>可以通过Git配置文件中的<tt class="docutils literal"><span class="pre">core.whitespace</span></tt>配置变量，设置开启更多的空白字符检查，将要开启的空白字符检查项用逗号分开即可。</p>
<p>如果希望对特定路径进行空白字符检查，则可以通过属性<tt class="docutils literal"><span class="pre">whitespace</span></tt>进行。属性<tt class="docutils literal"><span class="pre">whitespace</span></tt>可以有如下设置：</p>
<ul>
<li><p class="first">whitespace</p>
<p>开启所有的空白字符误用检查。</p>
</li>
<li><p class="first">-whitespace</p>
<p>不对空白字符进行误用检查。</p>
</li>
<li><p class="first">!whitespace</p>
<p>使用<tt class="docutils literal"><span class="pre">core.whitespace</span></tt>配置变量的设置进行空白字符误用检查。</p>
</li>
<li><p class="first">whitespace=...</p>
<p>和<tt class="docutils literal"><span class="pre">core.whitespace</span></tt>的语法一样，用逗号分隔各个空白字符检查项。</p>
</li>
</ul>
</div>
<div class="section" id="export-ignore">
<h3>8.2.1.3.8. export-ignore<a class="headerlink" href="#export-ignore" title="永久链接至标题">¶</a></h3>
<p>设置了该属性的文件和目录在执行<strong class="command">git archive</strong>时不予导出。</p>
</div>
<div class="section" id="export-subst">
<h3>8.2.1.3.9. export-subst<a class="headerlink" href="#export-subst" title="永久链接至标题">¶</a></h3>
<p>如果为文件设置了属性<tt class="docutils literal"><span class="pre">export-subst</span></tt>，则在使用<strong class="command">git archive</strong>导出项目文件时，会对相应文件内容中的占位符展开，然后再添加到归档中。注意如果在使用<strong class="command">git archive</strong>导出时使用树ID，而没有使用提交或者里程碑，则不会发生占位符展开。</p>
<p>占位符的格式为<tt class="docutils literal"><span class="pre">$Format:PLACEHOLDERS$</span></tt>，其中<tt class="docutils literal"><span class="pre">PLACEHOLDERS</span></tt>使用<strong class="command">git log &#8211;pretty=format:</strong>相同的参数（具体参见<strong class="command">git help log</strong>显示的帮助页）。例如：<tt class="docutils literal"><span class="pre">$Format:%H$</span></tt>将展开为提交的哈希值，<tt class="docutils literal"><span class="pre">$Format:%an$</span></tt>将展开为提交者姓名。</p>
</div>
<div class="section" id="delta">
<h3>8.2.1.3.10. delta<a class="headerlink" href="#delta" title="永久链接至标题">¶</a></h3>
<p>如果设置属性<tt class="docutils literal"><span class="pre">delta</span></tt>为<tt class="docutils literal"><span class="pre">false</span></tt>，则不对该路径指向的blob文件执行Delta压缩。</p>
</div>
<div class="section" id="encoding">
<h3>8.2.1.3.11. encoding<a class="headerlink" href="#encoding" title="永久链接至标题">¶</a></h3>
<p>设置文件所使用的字符集，以便使用GUI工具（如<tt class="docutils literal"><span class="pre">gitk</span></tt>和<tt class="docutils literal"><span class="pre">git-gui</span></tt>）能够正确显示文件内容。基于性能上的考虑，<tt class="docutils literal"><span class="pre">gitk</span></tt>默认不检查该属性，除非通过<tt class="docutils literal"><span class="pre">gitk</span></tt>的偏好设置启用“Support per-file encodings”。</p>
<p>如果没有为文件设置<tt class="docutils literal"><span class="pre">encoding</span></tt>属性，则使用<tt class="docutils literal"><span class="pre">git.encoding</span></tt>配置变量。</p>
</div>
<div class="section" id="binary">
<h3>8.2.1.3.12. binary<a class="headerlink" href="#binary" title="永久链接至标题">¶</a></h3>
<p>属性<tt class="docutils literal"><span class="pre">binary</span></tt>严格来说是一个宏，相当于<tt class="docutils literal"><span class="pre">-text</span> <span class="pre">-diff</span></tt>。即禁止换行符转换及禁止文本方式显示文件差异。</p>
<p>用户也可以自定义宏。自定义宏只能在工作区根目录中的<tt class="file docutils literal"><span class="pre">.gitattributes</span></tt>文件中添加，以内置的<tt class="docutils literal"><span class="pre">binary</span></tt>宏为例，相当于在属性文件中进行了如下的设置：</p>
<div class="highlight-python"><div class="highlight"><pre>[attr]binary -diff -text
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="070-hooks-and-templates.html" title="8.2.2. 钩子和模板"
             >下一页</a> |</li>
        <li class="right" >
          <a href="050-git-features.html" title="8.2. Git 的其他特性"
             >上一页</a> |</li>
        <li><a href="../index.html">GotGit</a> &raquo;</li>
          <li><a href="index.html" >8. Git杂谈</a> &raquo;</li>
          <li><a href="050-git-features.html" >8.2. Git 的其他特性</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="知识共享许可协议" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-sa/3.0/88x31.png" /></a>
      <br />
      全部内容以 <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons 署名-非商业性使用-相同方式共享 3.0 协议发布</a>.
      <br />
        &copy; Copyright 2011, 蒋鑫。
      使用 <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2.3 创建。

    </div>
  </body>
</html>